"use strict";let Chrome=new APIchrome;class notesController{constructor(){this.load=!0,Chrome.onUpdated({loadNotes:e=>{this.loadNotes(e)}}),Chrome.onMessages({sendUrlContentScript:async()=>{let e=await Chrome.getTab("active");Chrome.send({action:"urlContentScript",url:e[0].url},e[0].id)},hiddenNotes:()=>{this.hiddenNotes()},showNotes:()=>{this.showNotes()},deleteAll:async e=>{let t=await this.deleteAll();Chrome.send(t)},verifyURL:e=>{this.verifyURL(e)},sendUrlActive:async()=>{let e=await Chrome.getTab("active");Chrome.send({action:"recivedUrlActive",url:e[0].url})}}),Chrome.onCommand({createNote:async()=>{let e={default:await Chrome.getStorage("pallete-default"),user:await Chrome.getStorage("pallete-user")},t=await Chrome.getStorage("colorNoteSelect"),o=await Chrome.getStorage("anchorDomainCheck");o="empty"!=o&&o;let a=e=>{let t={key:e=>(e=e.replace("#color-default",""),e=e.replace("#color-user","")),pallete:e=>(e=e.replace("#color-",""),e="u"==e[0]?"user":"default")};return{key:t.key(e),pallete:t.pallete(e)}},r=a("empty"==t?"#color-default2":t);r=e[r.pallete][r.key],this.verifyURL({verifyURL:"createNote",noteColor:r.note,fontColor:r.font,tackColor:r.tack,anchorDomain:o,urlAnchor:"verifyURL"})},showHidden:async()=>{let e=await Chrome.getStorage("hiddenNotes");"show"==e?(this.hiddenNotes(),Chrome.setStorage("hiddenNotes","hidden")):"hidden"==e&&(this.showNotes(),Chrome.setStorage("hiddenNotes","show"))}})}async verifyURL(e){let t=await Chrome.getTab("active");"verifyURL"==e.urlAnchor&&(e.urlAnchor=t[0].url),"empty"==t||0==Chrome.filter(t[0])?(delete e.verifyURL,Chrome.send({action:"accessUrlBloked"})):(e.action=e.verifyURL,delete e.verifyURL,e.url=t[0].url,Chrome.send(e,t[0].id))}hiddenNotes(){this.load=!1,this.deleteAll("hiddenNotes")}showNotes(){this.load=!0,this.showAllNotes()}async showAllNotes(){let e=await Chrome.getTab();if("empty"!=e)for(let t=0;t<e.length;t++)Chrome.filter(e[t])&&this.loadNotes({tabId:e[t].id,status:e[t].status})}async deleteAll(e="deleteAll"){return await new Promise(async(t,o)=>{let a=0,r=await Chrome.getTab();if("empty"!=r)for(let t=0;t<r.length;t++)if(Chrome.filter(r[t])&&"complete"==r[t].status){let o=r[t].id;try{await Chrome.exeScript(o,{code:'EasyNotes.removeNotesHere({action:"'+e+'",url:"'+r[t].url+'", tabId:"'+o+'"})'})}catch(e){console.log("ERROR: es posible que deba cargar nuevamente la pestaÃ±a"+o+" para usar EasyNotes.("+r[t].url+") ")}}let l=await Chrome.getStorage();if("deleteAll"==e&&"empty"!=l)for(let e in l)"http"!=e.substring(0,4)&&"file"!=e.substring(0,4)&&"https"!=e.substring(0,5)||(await Chrome.removeStorage([e]),a++);t({action:"notesDelete",notesDelete:a=a>0?a:"0"})})}async loadNotes(e){if(1==this.load){let t=await Chrome.getTab(e.tabId),o=await Chrome.getStorage("hiddenNotes");if("empty"!=t&&"show"==o&&Chrome.filter(t)){let o=t.url;Chrome.send({action:"cleanNotesPageDynamic",url:o},e.tabId),Chrome.send({action:"loadNotes",url:o},e.tabId)}}}}new notesController;